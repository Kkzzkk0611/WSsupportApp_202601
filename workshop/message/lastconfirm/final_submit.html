<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FINAL STEP | 最終確認・提出</title>
    <link rel="stylesheet" href="./final_submit_styles.css?v=2.0.0">
    <!-- Leaflet (map preview) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
    <!-- Main Container -->
    <div class="container">
        
        <!-- Progress Navigation Tabs -->
        <nav class="progress-tabs">
            <button class="tab-item" data-page="hazard" onclick="navigateToPage('hazard')">
                <span class="tab-number">1</span>
                <span class="tab-label">対象地点/<br>ハザード</span>
                <span class="tab-badge warning" id="badge-hazard" style="display:none;">⚠</span>
            </button>
            <button class="tab-item" data-page="marbling" onclick="navigateToPage('marbling')">
                <span class="tab-number">2</span>
                <span class="tab-label">マーブリング</span>
                <span class="tab-badge warning" id="badge-marbling" style="display:none;">⚠</span>
            </button>
            <button class="tab-item" data-page="collage" onclick="navigateToPage('collage')">
                <span class="tab-number">3</span>
                <span class="tab-label">コラージュ</span>
                <span class="tab-badge warning" id="badge-collage" style="display:none;">⚠</span>
            </button>
            <button class="tab-item" data-page="artwork" onclick="navigateToPage('artwork')">
                <span class="tab-number">4</span>
                <span class="tab-label">作品情報</span>
                <span class="tab-badge warning" id="badge-artwork" style="display:none;">⚠</span>
            </button>
            <button class="tab-item active" data-page="final">
                <span class="tab-number">5</span>
                <span class="tab-label">最終確認</span>
            </button>
        </nav>

        <!-- Header Section -->
        <header class="final-header">
            <div class="step-badge">FINAL STEP</div>
            <h1 class="main-title">最終確認・提出</h1>
            <p class="subtitle">入力した内容を確認し、防災行動マップに登録します</p>
        </header>

        <!-- Step 1: Data Summary -->
        <section class="step-section" id="step-summary">
            <div class="step-header">
                <div class="step-icon">📋</div>
                <h2 class="step-title">Step 1: あなたの入力内容</h2>
            </div>
            
            <div class="summary-grid">
                <div class="summary-card">
                    <h3 class="summary-label">🗺️ 対象地点</h3>
                    <div id="summary-location" class="summary-value">読込中...</div>
                    <div id="summary-map" class="summary-map"></div>
                </div>
                
                <div class="summary-card">
                    <h3 class="summary-label">⚠️ 選択したハザードマップ</h3>
                    <div id="summary-hazards" class="summary-value">読込中...</div>
                </div>
                
                <div class="summary-card">
                    <h3 class="summary-label">🎨 マーブリング作品の意図</h3>
                    <div id="summary-marbling" class="summary-value">読込中...</div>
                </div>
                
                <div class="summary-card">
                    <h3 class="summary-label">✂️ コラージュ作品の意図</h3>
                    <div id="summary-collage" class="summary-value">読込中...</div>
                </div>
                
                <div class="summary-card">
                    <h3 class="summary-label">💬 作品タイトル</h3>
                    <div id="summary-title" class="summary-value">読込中...</div>
                </div>
                
                <div class="summary-card">
                    <h3 class="summary-label">✍️ 制作者名（ペンネーム）</h3>
                    <div id="summary-creator" class="summary-value">読込中...</div>
                </div>
            </div>
        </section>

        <!-- Step 3: Survey123 Submission -->
        <section class="step-section" id="step-survey">
            <div class="step-header">
                <div class="step-icon">📤</div>
                <h2 class="step-title">Step 2: Survey123で送信</h2>
            </div>

            <div class="survey-instructions">
                <h3 class="instructions-title">送信の手順</h3>
                <ol class="instructions-list">
                    <li>下の「Survey123を開く」ボタンをクリック</li>
                    <li>入力内容が自動で反映されていることを確認</li>
                    <li>作品画像をアップロード</li>
                    <li>内容を最終確認</li>
                    <li>Survey123画面の「送信」ボタンをクリック</li>
                </ol>
            </div>

            <!-- Survey123で手入力が必要な項目（注意） -->
            <div class="alert-card warning" id="survey-manual-note">
            <div class="alert-icon">⚠️</div>
            <div class="alert-content">
                <h3 class="alert-title">この3点はSurvey123で手入力してください</h3>
                <ul class="missing-list" id="manual-items-list">
                <li>作品制作日（Survey123内で入力）</li>
                <li>ハザードマップ（複数選択の場合、足りない分を追記）</li>
                <li>作品画像のアップロード（添付から追加）</li>
                </ul>
                <p class="info-note">
                ※このページで入力しても自動反映されないため、Survey123のフォーム内で入力してください。
                </p>
            </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-section">
                <button class="btn btn-large btn-primary" onclick="openSurvey123()" id="btn-open-survey">
                    📝 Survey123を開く →
                </button>
            </div>

            <!-- Survey123 Iframe Container -->
            <div id="survey-container" class="survey-container" style="display: none;">
                <div class="survey-header">
                    <div>
                        <h3>📝 Survey123 - 作品登録フォーム</h3>
                        <p class="survey-note">入力内容が自動で反映されています。確認後、画面下の「送信」ボタンをクリックしてください。</p>
                    </div>
                    <button class="btn-close" onclick="closeSurvey()">✕ 閉じる</button>
                </div>
                <div class="iframe-wrapper">
                    <iframe 
                        id="survey-iframe" 
                        frameborder="0" 
                        allowfullscreen
                        allow="geolocation; camera; microphone"
                    ></iframe>
                </div>
            </div>

            <!-- Completion Confirmation -->
            <div class="completion-check" id="completion-check" style="display:none;">
                <div class="check-card">
                    <label class="checkbox-label">
                        <input type="checkbox" id="checkbox-submitted" onchange="handleCompletionCheck()">
                        <span class="checkbox-text">
                            ✅ Survey123で「送信」ボタンを押して、送信が完了しました
                        </span>
                    </label>
                    <p class="check-help">送信が完了したら、上のチェックボックスにチェックを入れてください</p>
                </div>
            </div>
        </section>

        <!-- Step 4: Completion Message (hidden until checkbox is checked) -->
        <section class="step-section success-section" id="step-complete" style="display:none;">
            <div class="success-card">
                <div class="success-icon">🎉</div>
                <h2 class="success-title">作品が防災行動マップに登録されました！</h2>
                <p class="success-message">
                    あなたの作品が、防災への気づきを共有する作品集マップに追加されました。<br>
                    次のステップとして、防災行動を計画しましょう。
                </p>
                <div class="next-action">
                    <button class="btn btn-large btn-success" onclick="goToNextAction()">
                        🚀 次の防災行動マップへ →
                    </button>
                </div>
            </div>
        </section>



    </div>

    <!-- Scripts -->
    <script src="./final_submit_script.js?v=2.0.0"></script>
</body>
</html>
